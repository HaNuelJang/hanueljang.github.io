---
layout: post
title: OAuth 2.0
date: '2022-05-16 11:59:10 +0900'
description: 'Open Authorization'
categories: [Server, Protocol]
img: ''
tags: [Server]
---
## 목표
<hr>
최근 어느 사이트, 앱, 게임등 로그인 시 간편로그인 또는 연동하여 가입하기 등의 회원가입/로그인 방식을 사용하고 있다.  
왜 이런 기능이 생겨났고, 사용하고 있는지 알아보자.  
`다른 서비스의 자원을 효율적이고 안전하게 가져올 수 있는 방법`

## 간편로그인, 연동을 통해 무엇을 하는가?
<hr>
로그인 시 사용하는 간편로그인, 연동을 통해서 해당 서비스에서 무엇을 가져올까?
키워드를 확인해보자. `로그인`, `간편로그인`, `연동`, `다른 서비스`로 뽑을 수 있다.  
나름 해석해본다면 A서비스에 로그인을 하기위해 간편로그인을 사용하고, 간편로그인으로 B서비스의 리소스(자원)를 가져와 사용하는것.  

서비스는 다양해지고 새로운 서비스를 이용 할 때 마다 회원가입을 진행해야한다. 매번 회원가입을 진행해야하는 번거로움, 서비스마다 가입해야하는 양식도 재각각일뿐만 아니라 각 계정을 사용자가 직접 관리해야하는 불편함도 증가하게 된다. 따라서 사용자는 A서비스를 사용할 때의 가입/로그인 절차를 간소화 시킬 수 있는 장점이 있다.  
간편로그인을 도입하여 필수적으로 필요한 리소스를 타서비스에서 제공받아 재사용하는 `개방형 표준 프로토콜(OAuth2.0)`이 등장하게 되었다.

## 굳이 연동을 할 필요가 있을까? 직접 ID,PW를 등록한다면?
<hr>
가장 원시적인 방법부터.  
먼저 A서비스가 B서비스에서 특정유저(U)의 자원을 필요로 한다고 가정해보자. U의 리소스에 접근하려면 U의 식별자인 ID와 암호인 PW를 필요하게 된다.  
그리고 A서비스는 U의 ID,PW를 영속성 컨텍스트(persistence context)에 저장하고 필요시마다 꺼내어 B서비스에 요청하면 된다.  
간단하다. 하지만 문제점은 많다.  
1. 사용자는 A서비스를 신뢰할 수 있을까? = 내 정보를 해당 서비스에게 믿고 맞길 수 있을까?
2. B서비스는 A서비스를 신뢰할 수 있을까? = 실제 유저인가? 해커인가?
3. A서비스의 보안 문제가 B서비스로 확장된다. = 타 서비스의 보안문제를 떠안게 된다.
4. PW가 변경된다면 타서비스에 저장된 PW를 변경해야 한다.
5. 네트워크 통신중에 중요 정보가 빈번하게 노출된다.  
... 등 많은 불편/불안요소가 내제되어 있다.  

## 해결책 OAuth2.0
<hr>
> OAuth는 인터넷 사용자들이 비밀번호를 제공하지 않고 다른 웹사이트 상의 자신들의 정보에 대해 웹사이트나 애플리케이션의 접근 권한을 부여할 수 있는 공통적인 수단으로서 사용되는, 접근 위임을 위한 개방형 표준이다.[1] 이 매커니즘은 여러 기업들에 의해 사용되는데, 이를테면 아마존,[2] 구글, 페이스북, 마이크로소프트, 트위터가 있으며 사용자들이 타사 애플리케이션이나 웹사이트의 계정에 관한 정보를 공유할 수 있게 허용한다.

`OAuth(Open Authorization)`를 사용하여 해결 할 수 있다. 먼저 다른 서비스에 대한 ID,PW를 사용하지 않는다. 따라서 PW노출, 이중으로 관리해야하는 문제 등 해결 할 수 있다. (PW가 변경되어도 해당 서비스에서는 PW를 관리해야할 필요가 없으므로 문제가 되지 않는다.)  
인가서버를 통해 `인증( Authentification )`을 거치고, 인가서버로부터 `인가( Authorization )`(특정코드, 토큰)를 받아 필요한 리소스를 획득한다.

## OAuth 인증방식(4가지)
<hr>
1. Authorization Code Grant Type │ 권한 부여 승인 코드 방식
2. Implicit Grant Type │ 암묵적 승인 방식
3. Resource Owner Password Credentials Grant Type │ 자원 소유자 자격증명 승인 방식
4. Client Credentials Grant Type │ 클라이언트 자격증명 승인 방식

## Authorization Code Grant Type │ 권한 부여 승인 코드 방식
보편적인 방식으로 간편로그인에서 사용한다.  
FLOW  
1. Client는 Resource Owner에게 필요로하는 리소스를 알려주고, 인가코드를 요청한다.
2. Resource Owner는 Authorization Server에 인가코드를 요청한다.
3. Authorization Server는 Resource Owner에게 인증(Authentification)을 요청한다.
4. Resource Owner는 Authrization Server에게 인증(Authentification)을 한다.
5. Authorization Server는 인증(Authentification)을 확인하고, Resource Owner에게 인가코드를 반환한다. 
6. Resource Owner는 Client에게 인가코드를 전달한다.
7. Client는 Authorization Server에게 인가코드를 전달하고, Access token을 받는다.
8. Client는 Resource Server에게 Access token을 전달한다.
9. Resource Server는 Client에게 요구하는 리소스를 전달한다.


## Implicit Grant Type │ 암묵적 승인 방식

## Resource Owner Password Credentials Grant Type │ 자원 소유자 자격증명 승인 방식

## Client Credentials Grant Type │ 클라이언트 자격증명 승인 방식




